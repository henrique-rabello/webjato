<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="ng-app" ng-app="LoginApp">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="title" content="Log in" />
    <meta name="description" content="To create your site enter with your e-mail and password" />
    <title>Log in to Webjato</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700' rel='stylesheet' type='text/css' />
    <link rel="stylesheet" type="text/css" href="../css/animate.css" />
    <link rel="stylesheet" type="text/css" href="../css/site-institucional.css" />
    <script type="text/javascript" src="../scripts/wj-libs.js"></script>
    <script type="text/javascript" src="../scripts/wj.js"></script>
    <style type="text/css" media="screen">
        #btn-fb {
            position: absolute !important;
            top: 25px;
            left: 19px;
            opacity: 0;
        }

        .working {
            border: 0;
            position: absolute;
            right: 150px;
            top: 70px;
            z-index: 1;
        }

        .container-conta p {
            margin-top: 20px;
        }
    </style>
    <script type="text/javascript">
        var gScope = null;
        window.fbAsyncInit = function () {
            FB.init({
                appId: '538659419649795',
                xfbml: true,
                version: 'v2.4'
            });
        };

        function LoginWithFacebook() {
            gScope.WorkingFB = true;
            gScope.$apply();
            FB.api("/me?fields=name,email", function (response) {
                var id = response.id;
                var email = response.email;
                var fullname = response.name;
                gScope.NewFBAccount(id, email, fullname, "");
            });
        }

        angular.module("LoginApp", ["gettext", "ngCookies", "WebjatoDirectives", "WebjatoServices"])
            .controller("LoginCrtl",
                function ($scope, $http, $cookies, gettextCatalog) {
                    $scope.Email = "";
                    $scope.Password = "";
                    $scope.FullName = "";
                    $scope.ShowInvalidLogin = false;
                    $scope.ShowEmailInUse = false;
                    $scope.ShowFBEmailInUse = false;
                    $scope.ShowPwdEmailNotFound = false;
                    $scope.ShowPwdEmailSend = false;
                    $scope.ShowPwdFBInUse = false;
                    $scope.RetrievePasswordStatus = -1;
                    $scope.Working = false;
                    $scope.WorkingFB = false;
                    $scope.Login = function () {
                        $scope.ShowInvalidLogin = false;
                        $scope.Working = true;
                        $http({ method: "POST", url: "/api/user/login", params: { email: $scope.Email, password: $scope.Password } })
                            .success(function (data, status, headers, config) {
                                $scope.ProceedToMain();
                            })
                            .error(function (data, status, headers, config) {
                                $scope.ShowInvalidLogin = true;
                                $scope.Working = false;
                            });
                    };
                    $scope.LoginFB = function (fbId, email) {
                        $scope.ShowInvalidLogin = false;
                        $scope.WorkingFB = true;
                        $http({ method: "POST", url: "/api/user/loginfacebook", params: { fbid: fbId, email: email } })
                            .success(function (data, status, headers, config) {
                                $scope.WorkingFB = false;
                                $scope.ProceedToMain();
                            })
                            .error(function (data, status, headers, config) {
                                $scope.ShowInvalidLogin = true;
                            });
                    };
                    $scope.RetrievePassword = function () {
                        $scope.RetrievePasswordStatus = -1;
                        $http({ method: "POST", url: "/api/user/RetrievePassword", params: { email: $scope.Email } })
                            .success(function (data, status, headers, config) {
                                $scope.RetrievePasswordStatus = parseInt(data);
                            });
                    };
                    $scope.NewAccount = function () {
                        $scope.ShowEmailInUse = false;
                        $scope.Working = true;
                        $http({ method: "POST", url: "/api/user", params: { email: $scope.Email, password: $scope.Password, fullname: $scope.FullName } })
                            .success(function (data, status, headers, config) {
                                $scope.Working = false;
                                if (String(data) == "true") {
                                    $scope.Login();
                                }
                                else {
                                    $scope.ShowEmailInUse = true;
                                }
                            });
                    };
                    $scope.NewFBAccount = function (fbId, email, fullname, town) {
                        $scope.ShowFBEmailInUse = false;
                        $scope.WorkingFB = true;
                        $http({ method: "POST", url: "/api/user/facebook", params: { email: email, fullname: fullname, remoteid: fbId, town: town } })
                            .success(function (data, status, headers, config) {
                                if (String(data) == "false") {
                                    $scope.ShowFBEmailInUse = true;
                                    $scope.WorkingFB = false;
                                }
                                else {
                                    $scope.LoginFB(fbId, email)
                                }
                            });
                    };
                    $scope.IsEmailValid = function () {
                        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                        return re.test($scope.Email);
                    };
                    $scope.IsFullNameValid = function () {
                        return $scope.FullName.length >= 6;
                    };
                    $scope.IsPasswordValid = function () {
                        return $scope.Password.length >= 5;
                    };
                    $scope.ResetErrors = function () {
                        $scope.ShowInvalidLogin = $scope.ShowEmailInUse = $scope.ShowFBEmailInUse = false;
                        $scope.RetrievePasswordStatus = -1;
                    }
                    $scope.ProceedToMain = function () {
                        $http({ method: "GET", url: "/api/feature/get/0" })
                            .success(function (data) {
                                var isHelpEnabled = (String(data) == "true");
                                $scope.$emit("HelpSetState", isHelpEnabled, isHelpEnabled);
                                setTimeout(function () {
                                    top.location.href = "/main.html";
                                }, 250);
                            });
                    };
                    gScope = $scope;
                });
    </script>
    <!-- Google Analytics -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-33853723-1', 'auto');
        ga('send', 'pageview');
    </script>

</head>
<body ng-controller="LoginCrtl">
    <wj-help></wj-help>
    <div id="fb-root"></div>
    <script>
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.6";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>
    <!-- INICIO DO SITE  -->
    <div id="header">
        <div id="cont_menu">
            <ul id="bot">
                <li class="lup3">New to Webjato?</li>
                <li><a href="signup.html" class="lup lup2" title="">Sign up</a></li>
            </ul>
        </div>
        <div id="logo">
            <a href="index.html" class="" title="">
                <img src="../images/site_wj/logo_webjato.png" alt="Logo criar site com o webjato" title="" />
            </a>
        </div>
    </div>
    <div id="page">
        <!-- Título 1 -->
        <h1 class="light align-center bottom-1 margin-top-form">Log in</h1>
        <!-- Form inscrever-se -->
        <div class="container-box margin-side">
            <div class="container-conta">
                <div class="btn-face">
                    <img src="../images/site_wj/face_login.png" alt="" title="" />Log in with Facebook
                </div>
                <fb:login-button id="btn-fb" show-faces="false" size="xlarge" max-rows="1" scope="public_profile,email" onlogin="LoginWithFacebook();">Log in with Facebook</fb:login-button>
                <img class="working" src="../images/loadinganim2.gif" ng-show="WorkingFB" />
                <div class="cont-line">
                    <div class="ou">or</div>
                </div>
                <!-- E-mail -->
                <input id="f1" type="text" maxlength="132" placeholder="E-mail" ng-model="Email" ng-disabled="Working" autofocus=autofocus />
                <!-- Senha -->
                <input id="f2" type="password" maxlength="16" placeholder="Password" ng-model="Password" ng-disabled="Working" />
                <!-- Btn -->
                <button type="submit" id="f1Confirm" ng-class="{'disabled': !IsEmailValid() || !IsPasswordValid() || Working, 'enabled': IsEmailValid() && IsPasswordValid() && !Working}" ng-click="Login();">
                    Log in
                </button>
                <img class="working" src="../images/loadinganim2.gif" ng-show="Working" />
                <span class="error animated shake" ng-show="ShowInvalidLogin">Unknown e-mail/password. Try again.</span>
                <p>
                    <a href="esqueci-a-senha.html" class="" title="">Forgot your password?</a>
                </p>
            </div>
        </div>
    </div>
    <!-- Rodapé -->
    <div id="rodape">
        <div class="container">
            <div class="margin-side">
                <ul class="menu1">
                    <li><a href="about.html" title="">About</a></li>
                    <li><a href="terms.html" title="">Terms</a></li>
                    <li><a href="privacy_policy.html" title="">Privacy</a></li>
                    <li><a href="contents.html" title="">Contents</a></li>
                    <li><a href="support.html" title="">Support</a></li>
                </ul>
            </div>
            <div class="container-box margin-side float-right font-xsmall margin-top opacity">
                Follow and like:&nbsp;&nbsp;&nbsp;
                <a href="https://www.facebook.com/webjato" target="_blank"><img src="../images/site_wj/icone_face_gran.png" class="vert-align " alt="" title="" /></a>
                <a href="https://plus.google.com/+Webjato" target="_blank"><img src="../images/site_wj/icone_gmais_gran.png" class="vert-align img-margin" alt="" title="" /></a>
            </div>
        </div>
        <div class="font-xsmall font-cinza-claro space margin-top2">
            Webjato is a site to <strong>create sites</strong>. And you are our inspiration. <br />
            2016 © Webjato
        </div>
    </div>
</body>
</html>